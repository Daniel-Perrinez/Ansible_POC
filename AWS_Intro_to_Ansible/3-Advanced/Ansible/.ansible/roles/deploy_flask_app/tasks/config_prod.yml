---
- name: Configure Prod Host
  block:
    - name: Echo a string
      ansible.builtin.debug:
        msg: "Configure Prod Envirionment"

    - name: Install gunicorn Python modules
      ansible.builtin.pip:
        name:
          - gunicorn
        state: present
        executable: pip3
      become: true
      # https://developers.redhat.com/articles/2023/08/17/how-deploy-flask-application-python-gunicorn#the_application
      # Nginx can’t communicate directly with Flask app.
        # It can’t execute the application.
        # We need WSGI server (Gunicorn) to communicate between server and flask app.

    - name: Install Podman
      ansible.builtin.dnf:
        name:
          - podman
        update_cache: false
        state: present
      become: true

    - name: Build container
      ansible.builtin.include_tasks: build_container.yml
      register: image_ready

    - name: Deploy proccess
      ansible.builtin.include_tasks: deploy_process.yml
      when: image_ready.rc == 0

    # - name: Install nginx
    #   ansible.builtin.include_tasks: install_nginx.yml
